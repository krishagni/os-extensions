#macro(getMessage $code)$messageSource.getMessage($code, null, $locale)#end

<form>
  <view>
    <name>Participant</name>
    <caption>#getMessage("participant")</caption>
    <table>CPR_VIEW</table>
    <primaryKey>CPR_ID</primaryKey>
    <activeCondition>ACTIVITY_STATUS != 'Disabled'</activeCondition>
    <row>
      <numberField>
        <name>participantId</name>
        <udn>participantId</udn>
        <caption>#getMessage("participant_id")</caption>
        <column>PARTICIPANT_ID</column>
      </numberField>
    </row>

    <row>
      <datePicker>
        <name>deathDate</name>
        <udn>deathDate</udn>
        <caption>#getMessage("participant_death_date")</caption>
        <column>DEATH_DATE</column>
        <format>MM-dd-yyyy</format>
        <phi>true</phi>
      </datePicker>
    </row>

    <row>
      <textField>
        <name>vitalStatus</name>
        <udn>vitalStatus</udn>
        <caption>#getMessage("participant_vital_status")</caption>
        <column>VITAL_STATUS</column>
      </textField>
    </row>
    <row>
      <dropDown>
        <name>activityStatus</name>
        <udn>activityStatus</udn>
        <caption>#getMessage("participant_activity_status")</caption>
        <column>ACTIVITY_STATUS</column>
        <options>
          <option><value>Active</value></option>
          <option><value>Closed</value></option>
        </options>
      </dropDown>
    </row>

    <row>
      <subForm>
        <name>medicalRecord</name>
        <udn>medicalRecord</udn>
        <caption>#getMessage("participant_mrn")</caption>
        <table>CATISSUE_PART_MEDICAL_ID</table>
        <foreignKey>PARTICIPANT_ID</foreignKey>
        <parentKey>PARTICIPANT_ID</parentKey>
        <row>
          <numberField>
            <name>mrnSiteId</name>
            <udn>mrnSiteId</udn>
            <caption>#getMessage("participant_mrn_site_id")</caption>
            <column>SITE_ID</column>
            <recordUrl>#/object-state-params-resolver?stateName=site-detail.overview&amp;objectName=site&amp;key=id&amp;value={{$value}}</recordUrl>
          </numberField>
          <siteField>
            <name>mrnSiteName</name>
            <udn>mrnSiteName</udn>
            <caption>#getMessage("participant_mrn_site")</caption>
            <column>SITE_ID</column>
            <recordUrl>#/object-state-params-resolver?stateName=site-detail.overview&amp;objectName=site&amp;key=name&amp;value={{$value}}</recordUrl>
          </siteField>
        </row>
      </subForm>
    </row>

    <row>
      <numberField>
        <name>id</name>
        <udn>id</udn>
        <caption>#getMessage("cpr_id")</caption>
        <column>CPR_ID</column>
        <recordUrl>#/object-state-params-resolver?stateName=participant-detail.overview&amp;objectName=collection_protocol_registration&amp;key=id&amp;value={{$value}}</recordUrl>
      </numberField>
    </row>

    <row>
      <textField>
        <name>ppid</name>
        <udn>ppid</udn>
        <caption>#getMessage("participant_ppid")</caption>
        <column>PPID</column>
        <recordUrl>#/object-state-params-resolver?stateName=participant-detail.overview&amp;objectName=collection_protocol_registration&amp;key=id&amp;value={{$cprId}}</recordUrl>
      </textField>
    </row>

    <row>
      <subForm>
        <name>scgs</name>
        <udn>scgs</udn>
        <caption>#getMessage("participant_visits")</caption>
        <table>CATISSUE_SPECIMEN_COLL_GROUP</table>
        <foreignKey>COLLECTION_PROTOCOL_REG_ID</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <pathLink>true</pathLink>
        <row>
          <subForm>
            <name>specimens</name>
            <udn>specimens</udn>
            <caption>#getMessage("participant_visits_specimens")</caption>
            <table>CATISSUE_SPECIMEN</table>
            <foreignKey>SPECIMEN_COLLECTION_GROUP_ID</foreignKey>
            <parentKey>IDENTIFIER</parentKey>
            <pathLink>true</pathLink>

            <row>
              <subForm>
                <name>specimenOrders</name>
                <udn>specimenOrders</udn>
                <caption>#getMessage("participant_visits_specimens_order_items")</caption>
                <table>OS_ORDER_ITEMS</table>
                <foreignKey>SPECIMEN_ID</foreignKey>
                <parentKey>IDENTIFIER</parentKey>
                <row>
                  <subForm>
                    <name>order</name>
                    <udn>order</udn>
                    <caption>#getMessage("participant_visits_specimens_order_items_order")</caption>
                    <table>OS_ORDERS</table>
                    <foreignKey>IDENTIFIER</foreignKey>
                    <parentKey>ORDER_ID</parentKey>
                  </subForm>
                </row>
              </subForm>
            </row>

            <row>
              <subForm>
                <name>specimenShipments</name>
                <udn>specimenShipments</udn>
                <caption>#getMessage("specimen_shipment_items")</caption>
                <table>OS_SHIPMENT_SPECIMENS</table>
                <foreignKey>SPECIMEN_ID</foreignKey>
                <parentKey>IDENTIFIER</parentKey>

                <row>
                  <subForm>
                    <name>shipment</name>
                    <udn>shipment</udn>
                    <caption>#getMessage("specimen_shipment_items_shipment")</caption>
                    <table>OS_SHIPMENTS</table>
                    <foreignKey>IDENTIFIER</foreignKey>
                    <parentKey>SHIPMENT_ID</parentKey>
                  </subForm>
                </row>
              </subForm>
            </row>

            <row>
              <subForm>
                <name>specimenKits</name>
                <udn>specimenKits</udn>
                <caption>#getMessage("specimen_kit_specimens")</caption>
                <table>OS_KIT_SPECIMENS</table>
                <foreignKey>SPECIMEN_ID</foreignKey>
                <parentKey>IDENTIFIER</parentKey>

                <row>
                  <subForm>
                    <name>specimenKit</name>
                    <udn>specimenKit</udn>
                    <caption>#getMessage("specimen_kit")</caption>
                    <table>OS_SPECIMEN_KITS</table>
                    <foreignKey>IDENTIFIER</foreignKey>
                    <parentKey>KIT_ID</parentKey>
                  </subForm>
                </row>
              </subForm>
            </row>
          </subForm>
        </row>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>consentTier</name>
        <udn>consentTier</udn>
        <caption>#getMessage("participant_consent_tier")</caption>
        <table>CONSENT_TIER_VIEW</table>
        <foreignKey>CPR_ID</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <row>
          <dropDown>
            <name>consentResponseStatement</name>
            <udn>consentResponseStatement</udn>
            <caption>#getMessage("participant_consent_tier_response")</caption>
            <column>RESPONSE</column>
            <options>
              <sql>select value from catissue_permissible_value where public_id = 'consent_response' order by sortorder</sql>
            </options>
          </dropDown>
        </row>
      </subForm>
    </row>

    <row>
      <subForm>
        <name>customFields</name>
        <udn>customFields</udn>
        <caption>#getMessage("participant_field_extensions")</caption>
        <table>OS_PART_CUST_FIELD_EXTNS_VIEW</table>
        <foreignKey>PID</foreignKey>
        <parentKey>PARTICIPANT_ID</parentKey>
        <pathLink>true</pathLink>
        <extnFkCol>RECORD_ID</extnFkCol>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>extensions</name>
        <udn>extensions</udn>
        <caption>#getMessage("participant_extensions")</caption>
        <table>CPR_EXTENSION_RECORDS_VIEW</table>
        <foreignKey>CPR_ID</foreignKey>
        <parentKey>CPR_ID</parentKey>
        <pathLink>true</pathLink>
        <extnFkCol>RECORD_ID</extnFkCol>
      </subForm>
    </row>

    $querySvc.insertCustomQueryForms('cpr')
  </view>
</form>
